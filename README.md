# UK Gazetteer API and MCP Server

This project provides a high-performance API and a FastMCP server for looking up latitude and longitude coordinates for UK place names. It is designed to be used as a tool by Large Language Models (LLMs) to geocode place names within the UK.

## Overview

The system is composed of two main parts:

1.  **Gazetteer API Server**: A backend API built with **FastAPI** that serves coordinate data. It reads from a pre-processed **SQLite** database for fast, efficient lookups from a large CSV file.
2.  **FastMCP Server**: A server built with the **FastMCP** framework that exposes the lookup functionality as a simple `get_lat_long` tool for an LLM to use, abstracting away the underlying API calls.

## Features

-   **Fast Lookups**: Uses an indexed SQLite database to provide quick responses from a large dataset.
-   **Flexible API**: The FastAPI server supports exact, case-insensitive matching for place names and optional filtering by county.
-   **LLM-Ready Tool**: The FastMCP server provides a simple, high-level `get_lat_long` tool, perfect for LLM integration.
-   **Efficient Data Handling**: Processes a large 72MB+ CSV file into a lightweight database without loading the entire file into memory.

## Project Structure

```
.
├── GBPN.csv              # The raw gazetteer data (must be downloaded)
├── gazetteer.db          # The SQLite database (generated by ingest.py)
├── gazetteer_client.py   # A Python client for the Gazetteer API
├── ingest.py             # Script to ingest CSV data into the SQLite database
├── main.py               # The FastAPI server for the gazetteer API
├── mcp_server.py         # The FastMCP server exposing the get_lat_long tool
├── README.md             # This file
└── requirements.txt      # Python dependencies
```

## Setup and Installation

Follow these steps to get the project up and running.

### 1. Prerequisites

-   Python 3.8+
-   The `uv` package manager/runner is recommended (or `pip`).

### 2. Download the Gazetteer Data

This project requires the **GB Placenames CSV file (`GBPN.csv`)** from [gazetteer.org.uk](https://gazetteer.org.uk/purchase).

-   Download the file and place it in the root of this project directory.

### 3. Install Dependencies

Install all the necessary Python packages using `requirements.txt`.

```bash
pip install -r requirements.txt
```

### 4. Create the Database

Run the `ingest.py` script **once** to process the `GBPN.csv` file and create the `gazetteer.db` SQLite database. This may take a few moments.

```bash
python ingest.py
```

## Running the Servers

Both the Gazetteer API and the FastMCP server must be running simultaneously in separate terminals.

### Step 1: Run the Gazetteer API Server

This server exposes the raw data via a REST API.

```bash
# In your first terminal:
uvicorn main:app --reload --port 8000
```

The API will be available at `http://127.0.0.1:8000`.

### Step 2: Run the FastMCP Server

This server exposes the LLM tool. It depends on the Gazetteer API, so ensure the first server is running.

```bash
# In your second terminal:
python mcp_server.py
```

The FastMCP server will be available on its default port (e.g., 8192).

## Usage

### Using the Gazetteer API

You can query the API directly using `curl` or a browser:

```bash
# Exact search for a place name
curl "http://127.0.0.1:8000/lookup?placename=Cambridge"

# Filter by county
curl "http://127.0.0.1:8000/lookup?placename=Winchester&county=Hampshire"
```

### Using the FastMCP Tool

The FastMCP server exposes the `get_lat_long` tool, which your LLM can now call.

-   **Tool**: `get_lat_long(placename: str, county: Optional[str] = None)`
-   **Example**: An LLM wanting to know the weather in "Winchester, Hampshire" would first call `get_lat_long("Winchester", "Hampshire")` to get the coordinates before calling a weather tool.

## (Optional) Gemini CLI Integration

If you are using the Gemini CLI, you can configure it to automatically run the FastMCP server by adding the following to your `settings.json` file under `mcpServers`:

```json
"uk_gazetteer": {
  "command": "/path/to/your/uv",
  "args": [
    "run",
    "--",
    "mcp",
    "run",
    "mcp_server.py:mcp"
  ],
  "cwd": "/path/to/this/project/uk_gazetteer"
}
```
*Remember to replace the paths with the correct absolute paths for your system.*
